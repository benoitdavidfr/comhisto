title: définition du schéma du référentiel historique des codes INSEE des communes avec illustration
modified: '2020-07-14'
description: |
  Le champ $schema contient le schéma du référentiel.
  Le champ contents fournit des exemples illustratifs d'éléments de ce référentiel pour faciliter la compréhension du schéma.
  Journal:
    11/7/2020:
      Définition d'un nouveau schéma
$schema:
  title: schéma du référentiel historique des codes INSEE des communes
  $id: http://id.georef.eu/comhisto/insee/exhisto/$schema
  $schema: http://json-schema.org/draft-07/schema#
  description: |
    Le référentiel historique des codes INSEE des communes est principalement constitué d'un dictionnaire des codes INSEE des communes
    ayant existé depuis le 1/1/1943 associant à chaque code des infos versionnées indexées par la date de la version.
    Chaque version correspond à:
      - des évènements de création/modification/suppression de la version, sauf pour la version initiale datée du 1/1/1943,
      - l'état résultant des évènements de l'entité associée au code, valide à partir de la date de la version jusqu'à la date
        de la version suivante s'il y en a une, sinon valide à la date de validité du référentiel ;
        si les évènements conduisent à une suppression de l'entité alors le champ d'état est absent.
  definitions:
    codeInsee:
      description: code INSEE
      type: [string, number]
      pattern: '^\d[\dAB]\d\d\d$'
    listeDeCodesInsee:
      description: liste de codes INSEE
      type: array
      items:
        $ref: '#/definitions/codeInsee'
    evts:
      description: évènements de création/modification/suppression 
      anyOf: # le vérificateur n'arrive pas à détecter que les sous-schémas sont exclusifs
        - description: cas où l'évènement est défini par son libellé
          type: string
          enum:
            - Entre dans le périmètre du référentiel # Cas des c. de Mayotte qui devient DOM le 31/03/2011
            - Sort du périmètre du référentiel # Cas de Saint-Martin et Saint-Barthélémy
            - Commune associée rétablie comme commune simple
            - Commune déléguée rétablie comme commune simple
            - Commune rétablissant des c. rattachées ou fusionnées
        - description: cas où l'évènement est défini par un objet
          type: object
          additionalProperties: false
          properties:
            label:
              type: string
              enum:
                - Commune associée rétablie comme commune simple
            changeDeNomPour:
              description: changeDeNomPour - commune change de nom avec indication du nouveau nom
              type: string
            arriveDansLeDépartementAvecLeCode:
              description: arriveDansLeDépartementAvecLeCode - c. changeant de département avec précédent id
              $ref: '#/definitions/codeInsee'
            quitteLeDépartementEtPrendLeCode:
              description: quitteLeDépartementEtPrendLeCode - c. changeant d'id lors d'un changement de département avec nouvel id
              $ref: '#/definitions/codeInsee'
            reçoitUnePartieDe:
              description: reçoitUnePartieDe - c. recevant un territoire d'une c. supprimée avec l'id de la c. supprimée
              $ref: '#/definitions/codeInsee'
            seDissoutDans:
              description: seDissoutDans - c. supprimée avec ids des c. dans lesquelles son territoire est réparti
              $ref: '#/definitions/listeDeCodesInsee'
            contribueA:
              description: contribueA - commune contribuant à la création d'une commune avec l'id de la c. créée
              $ref: '#/definitions/codeInsee'
            crééeAPartirDe:
              description: crééeAPartirDe - c. créée avec liste des id des communes dont provient son territoire
              $ref: '#/definitions/listeDeCodesInsee'
            seFondDans:
              description: seFondDans - c. absorbée par une c. nouv. sans c. dél. avec id de la c. aborbante
              $ref: '#/definitions/codeInsee'
            absorbe:
              $ref: '#/definitions/listeDeCodesInsee'
            fusionneDans:
              description: fusionneDans - c. fusionnant par fusion-association dans une autre commune
              $ref: '#/definitions/codeInsee'
            crééeParFusionSimpleDe:
              description: c. créée par fusion de c. supprimées, un nouvel id est créé, avec liste des id des c. supprimées
              $ref: '#/definitions/listeDeCodesInsee'
            crééeCommeSimpleParScissionDe:
              description: c. simple créée par scission d'un c. existante avec id de la c. existante
              $ref: '#/definitions/codeInsee'
            seScindePourCréer:
              description: c. simple se scindant pour créer une c. avec id de la c. créée
              $ref: '#/definitions/listeDeCodesInsee'
            sAssocieA:
              description: c. s'associant par fusion-association à une commune de rattachement
              $ref: '#/definitions/codeInsee'
            prendPourAssociées:
              description: c. prenant des associées avec ids des c. associées
              $ref: '#/definitions/listeDeCodesInsee'
            devientDéléguéeDe:
              description: c. devenant déléguée lors de la création/évolution d'une c. nouv. avec id de la c. de rattachement
              $ref: '#/definitions/codeInsee'
            prendPourDéléguées:
              description: c. prenant des déléguées lors de la création/évolution d'une c. nouv. avec ids des c. déléguées
              $ref: '#/definitions/listeDeCodesInsee'
            changedAssociéeEnDéléguéeDe:
              description: c. associée devient déléguée avec id de la c. de rattachement
              $ref: '#/definitions/codeInsee'
            resteAssociéeA:
              description: c. restant associée à l'occasion d'une modification de l'association
              $ref: '#/definitions/codeInsee'
            gardeCommeAssociées:
              description: c. associante listant les c. restant associées à l'occasion d'une modification de l'association
              $ref: '#/definitions/listeDeCodesInsee'
            resteDéléguéeDe:
              description: c. restant déléguée à l'occasion d'une modification de la commune nouvelle
              $ref: '#/definitions/codeInsee'
            gardeCommeDéléguées:
              description: c. nouvelle listant les c. restant déléguées à l'occasion d'une modification de cette c. n.
              $ref: '#/definitions/listeDeCodesInsee'
            crééCommeArrondissementMunicipalParScissionDe:
              description: arrondissement municipal créé avec id de celui dont il est issu
              $ref: '#/definitions/codeInsee'
            seScindePourCréerLesNouveauxArrondissementsMunicipaux:
              description: arrondissements municipaux créés avec id de ceux créés
              $ref: '#/definitions/listeDeCodesInsee'
            crééeCommeAssociéeParScissionDe:
              description: c. associée créée avec id de la c. dont elle est issue
              $ref: '#/definitions/codeInsee'
            seScindePourCréerLesAssociées:
              description: c. associées créées avec id des c. créées
              $ref: '#/definitions/listeDeCodesInsee'
    etat:
      description: |
        état résultant des évènements et valide à partir de la date de la version jusqu'à la date de version suivante s'il y en a une,
        sinon valide à la date de validité du référentiel
      type: object
      required: [name, statut]
      properties:
        name:
          description: nom pour cette version
          type: string
        statut:
          description: statut de la commune
          type: string
          enum:
            - COMS # commune simple
            - COMA # commune associée
            - COMD # commune déléguée
            - COMM # commune mixte, c'est à dire que le code correspond à la fois à une commune simple et à une commune déléguée
            - ARDM # arrondissement municipal
        crat:
          description: code INSEE de la commune de rattachement ssi le statut est COMA, COMD ou ARDM
          $ref: '#/definitions/codeInsee'
        nomCommeDéléguée:
          description: ssi statut=COMM alors nom de la commune déléguée
          type: string
  type: object
  properties:
    title:
      description: titre du document contenant le référentiel
      type: string
    description:
      description: explication sur le document contenant le référentiel
      type: string
    created:
      description: date de création du document
      type: string
    modified:
      description: date de mise à jour du document
      type: string
    valid:
      description: date de validité du référentiel
      type: string
    $schema:
      description: soit le schéma du document soit un lien vers ce schéma
      oneOf:
        - $ref: http://json-schema.org/draft-07/schema#
        - type: string
    ydADscrBhv:
      description: paramètres de comportement utilisés par le code Php de la classe AutoDescribed
      type: object
      additionalProperties: false
      properties:
        jsonLdContext:
          description: contexte JSON-LD à ajouter
          type: string
        firstLevelType:
          description: type des enregistrements de premier niveau dans contents
          type: string
        buildName:
          description: définition de l'affichage réduit par type d'objet, code Php par type défini dans definitions
          type: object
          additionalProperties:
            description: Pour chaque type le code Php d'affichage réduit est défini comme chaine
            type: string
        writePserReally:
          description: si défini alors le doc est stocké en pser
          type: boolean
    contents:
      description: contenu du référentiel comme dictionnaire associant à chaque code INSEE ses différentes versions
      type: object
      additionalProperties: false
      patternProperties:
        '^\d[\dAB]\d\d\d$': # code INSEE
          description: les différentes versions indexées par une date et listées par ordre chronologique
          type: object
          additionalProperties: false
          patternProperties:
            '^\d\d\d\d-\d\d-\d\d$': # date
              description: |
                Version est composée d'une part d'évènements de création/modification/suppression (sauf pour la version du 1/1/1943
                qui est la version intiale) et, d'autre part, de l'état résultant des évènements valide à partir de la date de la
                version jusqu'à la date de version suivante, sauf en cas d'évènement de suppression pour lequel l'état n'existe pas.
              type: object
              additionalProperties: false
              properties:
                evts:
                  description: liste d'évènements
                  $ref: '#/definitions/evts'
                etat:
                  description: nouvel état résultant des évènements
                  $ref: '#/definitions/etat'
    eof:
      type: 'null'
ydADscrBhv:
  jsonLdContext: http://schema.org
  firstLevelType: AdministrativeArea
  buildName: # définition de l'affichage réduit par type d'objet, code Php par type
    AdministrativeArea: |
      $ckey = array_keys($item)[0];
      if (isset($item[$ckey]['etat']))
        return $item[$ckey]['etat']['name']." ($skey)";
      else
        return '<s>'.$item[array_keys($item)[1]]['etat']['name']." ($skey)</s>";
contents:
  '01015':
    '1943-01-01':
      etat: { name: Arbignieu, statut: COMS }
    '2016-01-01':
      evts: { prendPourDéléguées: ['01015', '01340'] }
      etat: { name: 'Arboys en Bugey', statut: COMM, nomCommeDéléguée: Arbignieu }
  '01079':
    '1943-01-01':
      etat: { name: Champagne, statut: COMS }
    '1956-10-19':
      evts: { changeDeNomPour: Champagne-en-Valromey }
      etat: { name: Champagne-en-Valromey, statut: COMS }
    '1973-01-01':
      evts: { prendPourAssociées: ['01217', '01287'] }
      etat: { name: Champagne-en-Valromey, statut: COMS }
    '1997-01-01':
      evts: { absorbe: ['01217', '01287'] }
      etat: { name: Champagne-en-Valromey, statut: COMS }
  '01217':
    '1943-01-01':
      etat: { name: Lilignod, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: '01079' }
      etat: { name: Lilignod, statut: COMA, crat: '01079' }
    '1997-01-01':
      evts: { fusionneDans: '01079' }
  13201:
    '1943-01-01':
      etat: { name: 'Marseille 1er Arrondissement', statut: ARDM, crat: 13055 }
  14513:
    '1943-01-01':
      etat: { name: Pont-Farcy, statut: COMS }
    '1973-05-01':
      evts: { prendPourAssociées: [14507] }
      etat: { name: Pont-Farcy, statut: COMS }
    '2018-01-01':
      evts: { absorbe: [14507], quitteLeDépartementEtPrendLeCode: 50649 }
  55273:
    '1943-01-01':
      etat: { name: Lamarche-en-Woëvre, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: 55245 }
      etat: { name: Lamarche-en-Woëvre, statut: COMS }
    '1983-01-01':
      evts: { label: 'Commune associée rétablie comme commune simple', sAssocieA: 55386 }
      etat: { name: Lamarche-en-Woëvre, statut: COMA, crat: 55386 }
  55245:
    '1943-01-01':
      etat: { name: Heudicourt-sous-les-Côtes, statut: COMS }
    '1973-01-01':
      evts: { prendPourAssociées: [55273, 55386] }
      etat: { name: Madine, statut: COMS }
    '1983-01-01':
      evts: 'Commune rétablissant des c. rattachées ou fusionnées'
      etat: { name: Heudicourt-sous-les-Côtes, statut: COMS }
  55386:
    '1943-01-01':
      etat: { name: Nonsard, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: 55245 }
      etat: { name: Nonsard, statut: COMS }
    '1983-01-01':
      evts: { label: 'Commune associée rétablie comme commune simple', prendPourAssociées: [55273] }
      etat: { name: Nonsard-Lamarche, statut: COMS }
  78001:
    '1943-01-01':
      etat: { name: Abbéville-la-Rivière, statut: COMS }
    '1968-01-01':
      evts: { quitteLeDépartementEtPrendLeCode: 91001 }
  91001:
    '1968-01-01':
      evts: { arriveDansLeDépartementAvecLeCode: 78001 }
      etat: { name: Abbéville-la-Rivière, statut: COMS }
eof:
