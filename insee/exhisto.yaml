title: définition du schéma du référentiel historique des codes INSEE des communes avec illustration
modified: '2020-07-27'
description: |
  Le schéma du référentiel est contenu dans le champ $schema de ce document.
  Le champ contents fournit des exemples illustratifs d'éléments de ce référentiel pour faciliter la compréhension du schéma.
  Journal:
    27/7/2020:
      Définition d'un nouveau schéma
    11/7/2020:
      Définition d'un nouveau schéma
$schema:
  title: schéma du référentiel historique des codes INSEE des communes
  $id: http://id.georef.eu/comhisto/insee/exhisto/$schema
  $schema: http://json-schema.org/draft-07/schema#
  description: |
    Le référentiel historique des codes INSEE des communes est principalement constitué d'un dictionnaire des codes INSEE des communes
    simples et des entités rattachées (communes associées, communes déléguées et arrondissements municipaux) ayant existé depuis le
    1/1/1943 associant à chaque code des infos versionnées indexées par la date de la version.
    Chaque version correspond à:
      - des évènements de création/modification/suppression de la version, sauf pour la version initiale généralement datée du 1/1/1943,
        sauf pour les communes de Mayotte, dont l'état initial est le 31/3/2011, date à laquelle Mayotte est devenu un département
        francais,
      - l'état résultant des évènements de l'entité associée au code, valide à partir de la date de la version jusqu'à la date
        de la version suivante s'il y en a une, sinon valide à la date de validité du référentiel ;
        cet état est absentsi les évènements conduisent à une suppression de l'entité alors le champ d'état est absent.
  definitions:
    codeInsee:
      description: code INSEE
      type: [string, number]
      pattern: '^\d[\dAB]\d\d\d$'
    listeDeCodesInsee:
      description: liste de codes INSEE
      type: array
      items:
        $ref: '#/definitions/codeInsee'
    evts:
      description: |
        Les opérations sur les entités sont décrites par des évènements de création/modification/suppression s'appliquant
        sur un code Insee ; la plupart prennent en paramètres un code INSEE ou une liste et, dans ce cas, les codes INSEE ciblés
        portent à la même un date un évènement appelé mirroir.
        La définition de ces types d'évènement respecte les principes suivants:
          - restriction du nombre pour faciliter la compréhension du modèle
          - définition de l'état issu d'un évènement par l'état précédent ainsi que les infos portées par l'évènement
          - facilité pour un humain de comprendre l'évolution de l'entité(s) associée(s) à un code Insee
      type: object
      additionalProperties: false
      properties:
        changeDeNomPour:
          description: entité changeant de nom avec indication en paramètre du nouveau nom (pas d'evt. mirroir)
          type: string
        sortDuPérimètreDuRéférentiel:
          description: entité sortant du périmètre du référentiel, cas de Saint-Martin et Saint-Barthélémy (pas d'évt mirroir)
          type: 'null'
        changeDeCodePour:
          description: entité changeant de code, en général lors d'un changement de département, avec nouveau code (mirroir avaitPourCode)
          $ref: '#/definitions/codeInsee'
        avaitPourCode:
          description: nouveau code, en général lors d'un changement de département, avec précédent code (mirroir changeDeCodePour)
          $ref: '#/definitions/codeInsee'
        seDissoutDans:
          description: c. supprimée avec codes des c. dans lesquelles son territoire est réparti (mirroir reçoitUnePartieDe)
          $ref: '#/definitions/listeDeCodesInsee'
        reçoitUnePartieDe:
          description: c. recevant une partie du territoire d'une c. supprimée avec le code de la c. supprimée (mirroir seDissoutDans)
          $ref: '#/definitions/codeInsee'
        crééeAPartirDe:
          description: c. créée avec liste des codes des communes dont provient son territoire (mirroir contribueA)
          $ref: '#/definitions/listeDeCodesInsee'
        contribueA:
          description: commune contribuant à la création d'une commune avec le code de la c. créée (mirroir crééeAPartirDe)
          $ref: '#/definitions/codeInsee'
        fusionneDans:
          description: |
            entité supprimée par fusion de son territoire dans une autre dont le code est en param. (mirroir absorbe)
            La fusion de 2 entités pour en créer une nouvelle est traduit par fusionneDans+changeDeCodePour
          $ref: '#/definitions/codeInsee'
        absorbe:
          description: entité en absorbant d'autres (m. fusionneDans)
          $ref: '#/definitions/listeDeCodesInsee'
        seScindePourCréer:
          description: entité se scindant pour en créer de nouvelles avec leur code (mirroir crééeCommeXXXParScissionDe)
          $ref: '#/definitions/listeDeCodesInsee'
        crééeCommeSimpleParScissionDe:
          description: c. simple créée par scission d'un e. existante avec son code (mirroir seScindePourCréer)
          $ref: '#/definitions/codeInsee'
        crééeCommeAssociéeParScissionDe:
          description: c. associée créée par scission d'un e. existante avec son code (mirroir seScindePourCréer)
          $ref: '#/definitions/codeInsee'
        crééCommeArrondissementMunicipalParScissionDe:
          description: arrdt municipal créé par scission d'un e. existante avec son code (mirroir seScindePourCréer)
          $ref: '#/definitions/codeInsee'
        estModifiéeIndirectementPar:
          description: CS modifiée par un évt intervenant sur ses ER avec codes de ces ER
          $ref: '#/definitions/listeDeCodesInsee'
        sAssocieA:
          description: |
            Entité s'associe à une commune de rattachement (mirroir prendPourAssociées)
            La commune de rattachement B doit être une commune simple.
            Si A était auparavant rattachée à une autre CS alors elle doit s'en détacher explicitement au préalable
            Si A avait des ER alors elles doivent simultanément s'en détacher
            Si A était mixte alors son ER est rattachée à B et sa CS disparait.
          $ref: '#/definitions/codeInsee'
        prendPourAssociées:
          description: c. simple prenant des associées avec code des c. associées (mirroir sAssocieA)
          $ref: '#/definitions/listeDeCodesInsee'
        devientDéléguéeDe:
          description: |
            e. devenant déléguée lors de la création/évolution d'une c. nouv. avec code de cette c. (m. prendPourDéléguées)
            La commune de rattachement B doit être une commune simple.
            Si A était rattachée à une autre CS alors elle s'en détache au préalable
            Si A avait des ER alors elles doivent simultanément soit se détacher soit se rattacher à une autre CS
            Si A était mixte alors son ER est rattachée à B et la CS disparait.
          $ref: '#/definitions/codeInsee'
        prendPourDéléguées:
          description: |
            CS prenant comme déléguées des entités lors de la création/évolution d'une c. nouv. avec codes des nouvelles c. déléguées
            (mirroir devientDéléguéeDe)
            Si la c. de ratt. et la c. déléguée ont même code alors il n'y a pas d'evt devientDéléguéeDe
          $ref: '#/definitions/listeDeCodesInsee'
        seDétacheDe:
          description: c. associées ou déléguées se sépare de sa c. de rattachement et devient c. simple (mirroir détacheCommeSimples)
          $ref: '#/definitions/codeInsee'
        détacheCommeSimples:
          description: la c. de rattachement se sépare de certaines de ses c. associées ou déléguées comme c. simples (m. seDétacheDe)
          $ref: '#/definitions/listeDeCodesInsee'
        resteAssociéeA:
          $ref: '#/definitions/codeInsee'
        gardeCommeAssociées:
          $ref: '#/definitions/listeDeCodesInsee'
        resteDéléguéeDe:
          $ref: '#/definitions/codeInsee'
        gardeCommeDéléguées:
          $ref: '#/definitions/listeDeCodesInsee'
    etat:
      description: |
        état résultant des évènements et valide à partir de la date de la version jusqu'à la date de version suivante s'il y en a une,
        sinon valide à la date de validité du référentiel
      type: object
      required: [name, statut]
      properties:
        name:
          description: nom de l'entité pour cette version
          type: string
        statut:
          description: statut de l'entité
          type: string
          enum:
            - COMS # commune simple
            - COMA # commune associée
            - COMD # commune déléguée
            - COMM # commune mixte, c'est à dire que le code correspond à la fois à une commune simple et à une commune déléguée
            - ARDM # arrondissement municipal
        crat:
          description: code INSEE de la commune de rattachement ssi le statut est COMA, COMD ou ARDM
          $ref: '#/definitions/codeInsee'
        nomCommeDéléguée:
          description: ssi statut=COMM alors nom de la commune déléguée
          type: string
  type: object
  properties:
    title:
      description: titre du document contenant le référentiel
      type: string
    description:
      description: explication sur le document contenant le référentiel
      type: string
    created:
      description: date de création du document
      type: string
    modified:
      description: date de mise à jour du document
      type: string
    valid:
      description: date de validité du référentiel
      type: string
    $schema:
      description: soit le schéma du document soit un lien vers ce schéma
      oneOf:
        - $ref: http://json-schema.org/draft-07/schema#
        - type: string
    ydADscrBhv:
      description: paramètres de comportement utilisés par le code Php de la classe AutoDescribed
      type: object
      additionalProperties: false
      properties:
        jsonLdContext:
          description: contexte JSON-LD à ajouter
          type: string
        firstLevelType:
          description: type des enregistrements de premier niveau dans contents
          type: string
        buildName:
          description: définition de l'affichage réduit par type d'objet, code Php par type défini dans definitions
          type: object
          additionalProperties:
            description: Pour chaque type le code Php d'affichage réduit est défini comme chaine
            type: string
        writePserReally:
          description: si défini alors le doc est stocké en pser
          type: boolean
    contents:
      description: contenu du référentiel comme dictionnaire associant à chaque code INSEE ses différentes versions
      type: object
      additionalProperties: false
      patternProperties:
        '^\d[\dAB]\d\d\d$': # code INSEE
          description: les différentes versions indexées par une date et listées par ordre chronologique
          type: object
          additionalProperties: false
          patternProperties:
            '^\d\d\d\d-\d\d-\d\d$': # date de la version
              description: |
                Version composée d'une part d'évènements de création/modification/suppression (sauf pour la version  intiale) et,
                d'autre part, de l'état, résultant des évènements, valide à partir de la date de la version jusqu'à la date de version
                suivante, sauf en cas d'évènement de suppression pour lequel il n'existe pas d'état résultant.
              type: object
              additionalProperties: false
              properties:
                evts:
                  description: liste d'évènements de création/modification/suppression
                  $ref: '#/definitions/evts'
                etat:
                  description: nouvel état résultant des évènements
                  $ref: '#/definitions/etat'
    eof:
      type: 'null'
ydADscrBhv:
  jsonLdContext: http://schema.org
  firstLevelType: AdministrativeArea
  buildName: # définition de l'affichage réduit par type d'objet, code Php par type
    AdministrativeArea: |
      $ckey = array_keys($item)[0];
      if (isset($item[$ckey]['etat']))
        return $item[$ckey]['etat']['name']." ($skey)";
      else
        return '<s>'.$item[array_keys($item)[1]]['etat']['name']." ($skey)</s>";
contents:
  '01015':
    '1943-01-01':
      etat: { name: Arbignieu, statut: COMS }
    '2016-01-01':
      evts: { prendPourDéléguées: ['01015', '01340'] }
      etat: { name: 'Arboys en Bugey', statut: COMM, nomCommeDéléguée: Arbignieu }
  '01079':
    '1943-01-01':
      etat: { name: Champagne, statut: COMS }
    '1956-10-19':
      evts: { changeDeNomPour: Champagne-en-Valromey }
      etat: { name: Champagne-en-Valromey, statut: COMS }
    '1973-01-01':
      evts: { prendPourAssociées: ['01217', '01287'] }
      etat: { name: Champagne-en-Valromey, statut: COMS }
    '1997-01-01':
      evts: { absorbe: ['01217', '01287'] }
      etat: { name: Champagne-en-Valromey, statut: COMS }
  '01217':
    '1943-01-01':
      etat: { name: Lilignod, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: '01079' }
      etat: { name: Lilignod, statut: COMA, crat: '01079' }
    '1997-01-01':
      evts: { fusionneDans: '01079' }
  13201:
    '1943-01-01':
      etat: { name: 'Marseille 1er Arrondissement', statut: ARDM, crat: 13055 }
  14513:
    '1943-01-01':
      etat: { name: Pont-Farcy, statut: COMS }
    '1973-05-01':
      evts: { prendPourAssociées: [14507] }
      etat: { name: Pont-Farcy, statut: COMS }
    '2018-01-01':
      evts: { absorbe: [14507], quitteLeDépartementEtPrendLeCode: 50649 }
  55273:
    '1943-01-01':
      etat: { name: Lamarche-en-Woëvre, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: 55245 }
      etat: { name: Lamarche-en-Woëvre, statut: COMS }
    '1983-01-01':
      evts: { seSépareDe: 55245, sAssocieA: 55386 }
      etat: { name: Lamarche-en-Woëvre, statut: COMA, crat: 55386 }
  55245:
    '1943-01-01':
      etat: { name: Heudicourt-sous-les-Côtes, statut: COMS }
    '1973-01-01':
      evts: { prendPourAssociées: [55273, 55386] }
      etat: { name: Madine, statut: COMS }
    '1983-01-01':
      evts: 'Commune rétablissant des c. rattachées ou fusionnées'
      etat: { name: Heudicourt-sous-les-Côtes, statut: COMS }
  55386:
    '1943-01-01':
      etat: { name: Nonsard, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: 55245 }
      etat: { name: Nonsard, statut: COMS }
    '1983-01-01':
      evts: { seSépareDe: 55245, prendPourAssociées: [55273] }
      etat: { name: Nonsard-Lamarche, statut: COMS }
  78001:
    '1943-01-01':
      etat: { name: Abbéville-la-Rivière, statut: COMS }
    '1968-01-01':
      evts: { quitteLeDépartementEtPrendLeCode: 91001 }
  91001:
    '1968-01-01':
      evts: { arriveDansLeDépartementAvecLeCode: 78001 }
      etat: { name: Abbéville-la-Rivière, statut: COMS }
eof:
