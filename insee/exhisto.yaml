title: définition du schéma du référentiel historique des codes INSEE des communes avec illustration
modified: '2020-07-19'
description: |
  Le schéma du référentiel est contenu dans le champ $schema de ce document.
  Le champ contents fournit des exemples illustratifs d'éléments de ce référentiel pour faciliter la compréhension du schéma.
  Journal:
    11/7/2020:
      Définition d'un nouveau schéma
$schema:
  title: schéma du référentiel historique des codes INSEE des communes
  $id: http://id.georef.eu/comhisto/insee/exhisto/$schema
  $schema: http://json-schema.org/draft-07/schema#
  description: |
    Le référentiel historique des codes INSEE des communes est principalement constitué d'un dictionnaire des codes INSEE des communes
    simples et des entités rattachées (communes associées, communes déléguées et arrondissements municipaux) ayant existé depuis le
    1/1/1943 associant à chaque code des infos versionnées indexées par la date de la version.
    Chaque version correspond à:
      - des évènements de création/modification/suppression de la version, sauf pour la version initiale généralement datée du 1/1/1943,
        sauf pour les communes de Mayotte, dont l'état initial est le 31/3/2011, date à laquelle Mayotte est devenu un département
        francais,
      - l'état résultant des évènements de l'entité associée au code, valide à partir de la date de la version jusqu'à la date
        de la version suivante s'il y en a une, sinon valide à la date de validité du référentiel ;
        si les évènements conduisent à une suppression de l'entité alors le champ d'état est absent.
  definitions:
    codeInsee:
      description: code INSEE
      type: [string, number]
      pattern: '^\d[\dAB]\d\d\d$'
    listeDeCodesInsee:
      description: liste de codes INSEE
      type: array
      items:
        $ref: '#/definitions/codeInsee'
    evts:
      description: |
        évènements de création/modification/suppression, la plupart des évènements prennent en paramètres un code INSEE ou une liste.
        Dans ce cas les codes INSEE ciblés portent à la même un date un évènement appelé mirroir.
      type: object
      additionalProperties: false
      properties:
        changeDeNomPour:
          description: commune changeant de nom avec indication du nouveau nom (pas d'evt. mirroir)
          type: string
        sortDuPérimètreDuRéférentiel:
          description: commune sortant du périmètre du référentiel, cas de Saint-Martin et Saint-Barthélémy (pas d'évt mirroir)
          type: 'null'
        quitteLeDépartementEtPrendLeCode:
          description: c. changeant d'id lors d'un changement de département avec nouvel id (mirroir arriveDansLeDépartementAvecLeCode)
          $ref: '#/definitions/codeInsee'
        arriveDansLeDépartementAvecLeCode:
          description: c. changeant de département avec précédent id (mirroir quitteLeDépartementEtPrendLeCode)
          $ref: '#/definitions/codeInsee'
        seDissoutDans:
          description: c. supprimée avec ids des c. dans lesquelles son territoire est réparti (mirroir reçoitUnePartieDe)
          $ref: '#/definitions/listeDeCodesInsee'
        reçoitUnePartieDe:
          description: c. recevant une partie du territoire d'une c. supprimée avec l'id de la c. supprimée (mirroir seDissoutDans)
          $ref: '#/definitions/codeInsee'
        contribueA:
          description: commune contribuant à la création d'une commune avec l'id de la c. créée (mirroir crééeAPartirDe)
          $ref: '#/definitions/codeInsee'
        crééeAPartirDe:
          description: c. créée avec liste des id des communes dont provient son territoire (mirroir contribueA)
          $ref: '#/definitions/listeDeCodesInsee'
        seFondDans:
          description: c. absorbée par une c. nouvelle sans c. déléguée avec id de la c. nouvelle (mirroir absorbe)
          $ref: '#/definitions/codeInsee'
        absorbe:
          description: c. nouvelle absorbant des c. (m. seFondDans) ou c. absorbant des c. dans le cas d'une fusion (m. fusionneDans)
          $ref: '#/definitions/listeDeCodesInsee'
        fusionneDans:
          description: |
            c. fusionnant par fusion-association dans une autre commune (mirroir absorbe) ou c. fusionnant pour créer une nouvelle
            commune (mirroir crééeParFusionSimpleDe)
          $ref: '#/definitions/codeInsee'
        crééeParFusionSimpleDe:
          description: |
            c. créée par fusion de c. supprimées avec création d'un nouvel id, avec liste des id des c. supprimées,
            1 seul cas (mirroir fusionneDans)
          $ref: '#/definitions/listeDeCodesInsee'
        crééeCommeSimpleParScissionDe:
          description: c. simple créée par scission d'un c. existante avec id de la c. existante (mirroir seScindePourCréer)
          $ref: '#/definitions/codeInsee'
        seScindePourCréer:
          description: c. simple se scindant pour créer une c. avec id de la c. créée (mirroir crééeCommeSimpleParScissionDe)
          $ref: '#/definitions/listeDeCodesInsee'
        sAssocieA:
          description: c. s'associant par fusion-association à une commune de rattachement (mirroir prendPourAssociées)
          $ref: '#/definitions/codeInsee'
        prendPourAssociées:
          description: c. prenant des associées avec ids des c. associées (mirroir sAssocieA)
          $ref: '#/definitions/listeDeCodesInsee'
        seSépareDe:
          description: c. associées ou déléguées se sépare de sa c. de rattachement et devient c. simple (mirroir détacheCommeSimples)
          $ref: '#/definitions/codeInsee'
        détacheCommeSimples:
          description: la c. de rattachement se sépare certaines de ses c. associées ou déléguées comme c. simples (m. seSépareDe)
          $ref: '#/definitions/listeDeCodesInsee'
        devientDéléguéeDe:
          description: c. devenant déléguée lors de la création/évolution d'une c. nouv. avec id de c. de ratt (m. prendPourDéléguées)
          $ref: '#/definitions/codeInsee'
        prendPourDéléguées:
          description: |
            3 cas:
              - c. prenant comme c. déléguées des c. simples lors de la création/évolution d'une c. nouv. avec ids des c. déléguées
                (mirroir devientDéléguéeDe),
              - c. de ratt. et c. déléguée peuvent avoir même code INSEE, l'évt mirroir est alors lui-même,
              - c. prenant comme c. déléguée des c. déjà associées (mirroir changedAssociéeEnDéléguéeDe)
          $ref: '#/definitions/listeDeCodesInsee'
        changedAssociéeEnDéléguéeDe:
          description: c. associée devient déléguée avec id de la c. de rattachement (mirroir prendPourDéléguées)
          $ref: '#/definitions/codeInsee'
        resteAssociéeA:
          description: c. restant associée à l'occasion d'une modification de l'association (mirroir gardeCommeAssociées)
          $ref: '#/definitions/codeInsee'
        gardeCommeAssociées:
          description: c. associante listant les c. restant associées lors d'une modification de l'association (m. resteAssociéeA)
          $ref: '#/definitions/listeDeCodesInsee'
        resteDéléguéeDe:
          description: c. restant déléguée à l'occasion d'une modification de la commune nouvelle (mirroir gardeCommeDéléguées)
          $ref: '#/definitions/codeInsee'
        gardeCommeDéléguées:
          description: c. nouvelle listant les c. restant déléguées à l'occasion d'une modif. de cette c. nouv. (m. resteDéléguéeDe)
          $ref: '#/definitions/listeDeCodesInsee'
        perdRattachementPour:
          description: la c. de rattachement devient c. rattachée d'une de ses c. rattachées qui est indiquée (m. prendLeRattachementDe)
          $ref: '#/definitions/codeInsee'
        prendLeRattachementDe:
          description: c. rattachée prenant le rtchmt avec en param. les rattachées (m. perdRattachementPour+changeDeRattachementPour)
          $ref: '#/definitions/listeDeCodesInsee'
        changeDeRattachementPour:
          description: c. rattachée changeant de rattachement avec en param. la nouv. c. de rattchmt (m. prendLeRattachementDe)
          $ref: '#/definitions/codeInsee'
        crééCommeArrondissementMunicipalParScissionDe:
          description: arrdt municipal créé avec id de celui dont il est issu (m. seScindePourCréerLesNouveauxArrondissementsMunicipaux)
          $ref: '#/definitions/codeInsee'
        seScindePourCréerLesNouveauxArrondissementsMunicipaux:
          description: arrondissements municipaux créés avec id de ceux créés (m. crééCommeArrondissementMunicipalParScissionDe)
          $ref: '#/definitions/listeDeCodesInsee'
        crééeCommeAssociéeParScissionDe:
          description: c. associée créée avec id de la c. dont elle est issue (mirroir seScindePourCréerLesAssociées)
          $ref: '#/definitions/codeInsee'
        seScindePourCréerLesAssociées:
          description: c. associées créées avec id des c. créées (mirroir crééeCommeAssociéeParScissionDe)
          $ref: '#/definitions/listeDeCodesInsee'
        créationDUneRattachéeParScissionDe:
          description: création d'une e. rattachée vue de la c. simple en indiquant l'e. qui se scinde
          $ref: '#/definitions/codeInsee'
    etat:
      description: |
        état résultant des évènements et valide à partir de la date de la version jusqu'à la date de version suivante s'il y en a une,
        sinon valide à la date de validité du référentiel
      type: object
      required: [name, statut]
      properties:
        name:
          description: nom de l'entité pour cette version
          type: string
        statut:
          description: statut de l'entité
          type: string
          enum:
            - COMS # commune simple
            - COMA # commune associée
            - COMD # commune déléguée
            - COMM # commune mixte, c'est à dire que le code correspond à la fois à une commune simple et à une commune déléguée
            - ARDM # arrondissement municipal
        crat:
          description: code INSEE de la commune de rattachement ssi le statut est COMA, COMD ou ARDM
          $ref: '#/definitions/codeInsee'
        nomCommeDéléguée:
          description: ssi statut=COMM alors nom de la commune déléguée
          type: string
  type: object
  properties:
    title:
      description: titre du document contenant le référentiel
      type: string
    description:
      description: explication sur le document contenant le référentiel
      type: string
    created:
      description: date de création du document
      type: string
    modified:
      description: date de mise à jour du document
      type: string
    valid:
      description: date de validité du référentiel
      type: string
    $schema:
      description: soit le schéma du document soit un lien vers ce schéma
      oneOf:
        - $ref: http://json-schema.org/draft-07/schema#
        - type: string
    ydADscrBhv:
      description: paramètres de comportement utilisés par le code Php de la classe AutoDescribed
      type: object
      additionalProperties: false
      properties:
        jsonLdContext:
          description: contexte JSON-LD à ajouter
          type: string
        firstLevelType:
          description: type des enregistrements de premier niveau dans contents
          type: string
        buildName:
          description: définition de l'affichage réduit par type d'objet, code Php par type défini dans definitions
          type: object
          additionalProperties:
            description: Pour chaque type le code Php d'affichage réduit est défini comme chaine
            type: string
        writePserReally:
          description: si défini alors le doc est stocké en pser
          type: boolean
    contents:
      description: contenu du référentiel comme dictionnaire associant à chaque code INSEE ses différentes versions
      type: object
      additionalProperties: false
      patternProperties:
        '^\d[\dAB]\d\d\d$': # code INSEE
          description: les différentes versions indexées par une date et listées par ordre chronologique
          type: object
          additionalProperties: false
          patternProperties:
            '^\d\d\d\d-\d\d-\d\d$': # date de la version
              description: |
                Version composée d'une part d'évènements de création/modification/suppression (sauf pour la version  intiale) et,
                d'autre part, de l'état, résultant des évènements, valide à partir de la date de la version jusqu'à la date de version
                suivante, sauf en cas d'évènement de suppression pour lequel il n'existe pas d'état résultant.
              type: object
              additionalProperties: false
              properties:
                evts:
                  description: liste d'évènements de création/modification/suppression
                  $ref: '#/definitions/evts'
                etat:
                  description: nouvel état résultant des évènements
                  $ref: '#/definitions/etat'
    eof:
      type: 'null'
ydADscrBhv:
  jsonLdContext: http://schema.org
  firstLevelType: AdministrativeArea
  buildName: # définition de l'affichage réduit par type d'objet, code Php par type
    AdministrativeArea: |
      $ckey = array_keys($item)[0];
      if (isset($item[$ckey]['etat']))
        return $item[$ckey]['etat']['name']." ($skey)";
      else
        return '<s>'.$item[array_keys($item)[1]]['etat']['name']." ($skey)</s>";
contents:
  '01015':
    '1943-01-01':
      etat: { name: Arbignieu, statut: COMS }
    '2016-01-01':
      evts: { prendPourDéléguées: ['01015', '01340'] }
      etat: { name: 'Arboys en Bugey', statut: COMM, nomCommeDéléguée: Arbignieu }
  '01079':
    '1943-01-01':
      etat: { name: Champagne, statut: COMS }
    '1956-10-19':
      evts: { changeDeNomPour: Champagne-en-Valromey }
      etat: { name: Champagne-en-Valromey, statut: COMS }
    '1973-01-01':
      evts: { prendPourAssociées: ['01217', '01287'] }
      etat: { name: Champagne-en-Valromey, statut: COMS }
    '1997-01-01':
      evts: { absorbe: ['01217', '01287'] }
      etat: { name: Champagne-en-Valromey, statut: COMS }
  '01217':
    '1943-01-01':
      etat: { name: Lilignod, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: '01079' }
      etat: { name: Lilignod, statut: COMA, crat: '01079' }
    '1997-01-01':
      evts: { fusionneDans: '01079' }
  13201:
    '1943-01-01':
      etat: { name: 'Marseille 1er Arrondissement', statut: ARDM, crat: 13055 }
  14513:
    '1943-01-01':
      etat: { name: Pont-Farcy, statut: COMS }
    '1973-05-01':
      evts: { prendPourAssociées: [14507] }
      etat: { name: Pont-Farcy, statut: COMS }
    '2018-01-01':
      evts: { absorbe: [14507], quitteLeDépartementEtPrendLeCode: 50649 }
  55273:
    '1943-01-01':
      etat: { name: Lamarche-en-Woëvre, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: 55245 }
      etat: { name: Lamarche-en-Woëvre, statut: COMS }
    '1983-01-01':
      evts: { seSépareDe: 55245, sAssocieA: 55386 }
      etat: { name: Lamarche-en-Woëvre, statut: COMA, crat: 55386 }
  55245:
    '1943-01-01':
      etat: { name: Heudicourt-sous-les-Côtes, statut: COMS }
    '1973-01-01':
      evts: { prendPourAssociées: [55273, 55386] }
      etat: { name: Madine, statut: COMS }
    '1983-01-01':
      evts: 'Commune rétablissant des c. rattachées ou fusionnées'
      etat: { name: Heudicourt-sous-les-Côtes, statut: COMS }
  55386:
    '1943-01-01':
      etat: { name: Nonsard, statut: COMS }
    '1973-01-01':
      evts: { sAssocieA: 55245 }
      etat: { name: Nonsard, statut: COMS }
    '1983-01-01':
      evts: { seSépareDe: 55245, prendPourAssociées: [55273] }
      etat: { name: Nonsard-Lamarche, statut: COMS }
  78001:
    '1943-01-01':
      etat: { name: Abbéville-la-Rivière, statut: COMS }
    '1968-01-01':
      evts: { quitteLeDépartementEtPrendLeCode: 91001 }
  91001:
    '1968-01-01':
      evts: { arriveDansLeDépartementAvecLeCode: 78001 }
      etat: { name: Abbéville-la-Rivière, statut: COMS }
eof:
